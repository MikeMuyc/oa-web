(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0af109"],{"0d76":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"edit_view"},[o("div",{staticClass:"back"},[o("Button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),o("Collapse",{attrs:{value:"1"}},[o("Panel",{attrs:{name:"1","hide-arrow":!0}},[t._v(" 角色详情 "),o("Button",{directives:[{name:"authox",rawName:"v-authox",value:"authox|manage",expression:"'authox|manage'"}],attrs:{type:"text",size:"small"},on:{click:function(e){e.stopPropagation(),t.modal=!0}}},[t._v("编辑基本信息")]),o("div",{attrs:{slot:"content"},slot:"content"},[o("table",{staticClass:"info_table",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[o("tr",[o("td",[o("span",[t._v("角色标识：")]),o("span",[t._v(t._s(t.roleInfo.role))])]),o("td",[o("span",[t._v("角色名：")]),o("span",[t._v(t._s(t.roleInfo.name))])]),o("td",[o("span",[t._v("备注：")]),o("span",[t._v(t._s(t.roleInfo.des))])])]),o("tr",[o("td",[o("span",[t._v("父节点：")]),t._l(t.roleInfo.parents,(function(e,a){return o("Tag",{key:a,attrs:{type:"border",color:"primary"}},[t._v(t._s(e))])}))],2),o("td",[o("span",[t._v("创建时间：")]),o("span",[t._v(t._s(t._f("dateFormat")(t.roleInfo.createtimestamp,"yyyy-MM-dd HH:mm:ss")))])])])])])],1)],1),o("Collapse",{attrs:{value:"1"}},[o("Panel",{attrs:{name:"1","hide-arrow":!0}},[t._v(" 角色权限 "),t.isEdited?o("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){e.stopPropagation(),t.isEdited=!1}}},[t._v("编辑权限")]):t._e(),t.isEdited?t._e():o("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.saveRole(e)}}},[t._v("保存修改")]),t.isEdited?t._e():o("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){return e.stopPropagation(),t.cancelRole(e)}}},[t._v("取消修改")]),o("div",{attrs:{slot:"content"},slot:"content"},[o("table",{staticClass:"info_table",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[o("tr",[o("th",{staticStyle:{width:"120px"}},[t._v("客体")]),o("th",[t._v("操作项")])]),t._l(t.allRules,(function(e){return o("tr",[o("td",[o("span",{staticStyle:{"line-height":"2"}},[t._v(t._s(t.objs[e.objectTag]))])]),o("td",t._l(e.ops,(function(e){return o("span",[o("Button",{attrs:{type:e.checked?"default":"text",icon:e.checked?"md-checkmark":"",disabled:t.isEdited},on:{click:function(t){e.checked=!e.checked}}},[t._v(t._s(t.opes[e.op]))])],1)})),0)])}))],2)])],1)],1),o("Collapse",{attrs:{value:"1"}},[o("Panel",{attrs:{name:"1","hide-arrow":!0}},[t._v(" 引用记录 "),o("div",{attrs:{slot:"content"},slot:"content"},[o("Table",{attrs:{columns:t.subjectsColumns,data:t.subjects,size:"small",stripe:""}})],1)])],1),o("Modal",{attrs:{title:"编辑角色"},on:{"on-ok":t.saveData,"on-cancel":function(e){t.modal=!1,t.loadData()}},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[o("Form",{attrs:{model:t.roleInfo,"label-width":80}},[o("FormItem",{attrs:{label:"*角色名称"}},[o("Input",{attrs:{type:"text"},model:{value:t.roleInfo.name,callback:function(e){t.$set(t.roleInfo,"name",e)},expression:"roleInfo.name"}})],1),o("FormItem",{attrs:{label:"父节点"}},[o("Select",{attrs:{multiple:""},model:{value:t.roleInfo.parents,callback:function(e){t.$set(t.roleInfo,"parents",e)},expression:"roleInfo.parents"}},t._l(t.roleList,(function(t){return o("Option",{key:t.role,attrs:{value:t.name,label:t.name}})})),1)],1),o("FormItem",{attrs:{label:"备注"}},[o("Input",{attrs:{type:"text"},model:{value:t.roleInfo.des,callback:function(e){t.$set(t.roleInfo,"des",e)},expression:"roleInfo.des"}})],1)],1)],1)],1)},s=[],n=(o("4160"),o("b0c0"),o("159b"),o("e069")),l={components:{Collapse:n["Collapse"],Button:n["Button"],Modal:n["Modal"],Panel:n["Panel"],Transfer:n["Transfer"],Form:n["Form"],FormItem:n["FormItem"],Input:n["Input"],Table:n["Table"]},data:function(){return{modal:!1,id:this.$route.query.id,isEdited:!0,subjects:[],roleList:[],objs:[],opes:[],allRules:[],subjectsColumns:[{title:"被授权对象",key:"name"},{title:"备注",key:"des"},{title:"类型",key:"type"}],roleInfo:{}}},created:function(){this.loadData(),this.getRoleList(),this.getSubjects(),this.getRoleDetail()},methods:{loadData:function(){var t=this;this.$http.get("/rest/authox/roles/"+this.id).then((function(e){t.roleInfo=e.data})).catch((function(t){console.log(t.data)}))},getRoleList:function(){var t=this;this.$http.get("/rest/authox/roles/"+this.id+"/validRoles").then((function(e){t.roleList=e.data})).catch((function(t){console.log(t.data)}))},getSubjects:function(){var t=this;this.$http.get("/rest/authox/roles/"+this.id+"/subjects").then((function(e){t.subjects=e.data})).catch((function(t){console.log(t.data)}))},getRoleDetail:function(){var t=this;this.$http.all([this.$http.get("rest/authox/objects"),this.$http.get("rest/authox/operations"),this.$http.get("rest/authox/objectOps")]).then(this.$http.spread((function(e,o,a){t.objs=e.data,t.opes=o.data;var s=a.data;t.allRules=[],s.forEach((function(e){var o=!1;if(t.allRules.forEach((function(t){t.objectTag===e.objectcode&&(o=!0,t.ops.push({op:e.opcode,checked:!1}))})),!o){var a={};a.objectTag=e.objectcode,a.isEdited=!1,a.ops=[],a.ops.push({op:e.opcode,checked:!1}),t.allRules.push(a)}})),t.$http.get("rest/authox/roles/"+t.id+"/rules").then((function(e){var o=e.data;o.forEach((function(e){t.allRules.forEach((function(t){e.objectTag===t.objectTag&&t.ops.forEach((function(t){t.op===e.op&&(t.checked=!0)}))}))}))}))}))).catch((function(t){console.log(t)}))},saveRole:function(){var t=this,e=[];this.allRules.forEach((function(t){t.ops.forEach((function(o){if(o.checked){var a={objectTag:t.objectTag,op:o.op};e.push(a)}}))})),this.$http.post("rest/authox/roles/"+this.id+"/rules",e).then((function(e){t.isEdited=!0,t.getRoleDetail(),t.$Message.success("保存成功！")})).catch((function(e){t.$Message.error("保存失败！"),console.log(e)}))},cancelRole:function(){this.getRoleDetail(),this.isEdited=!0},saveData:function(){var t=this,e={role:this.roleInfo.role,name:this.roleInfo.name,des:this.roleInfo.des,parents:[]};this.roleInfo.parents.forEach((function(o){t.roleList.forEach((function(t){t.name==o&&e.parents.push(t.role)}))})),this.$http.post("/rest/authox/roles/"+this.id,e).then((function(e){t.modal=!1,t.$Message.success("保存成功！"),t.loadData()})).catch((function(e){t.$Message.error("保存失败！"),console.log(e)}))}}},r=l,i=o("2877"),c=Object(i["a"])(r,a,s,!1,null,"7f157063",null);e["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d0af109.d7613eda.js.map